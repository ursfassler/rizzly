
Point = Record
  x : R{0,255};
  y : R{0,255};
end

Expr = Elementary
  out1tick : signal( x: R{0,255} );
  out1tack : query( x: R{0,255} ):R{0,255};
  out2tick : signal( x: R{0,255} );
  out2tack : query( x: R{0,255} ):R{0,255};
  out3tick : signal( x: R{0,255} );
  out3tack : query( x: R{0,255} ):R{0,255};
  out4tack : query():Point;
  out4tock : signal();
    
  a : Array{10,Point} = ( [ x := 10, y := 20 ] );
  f : R{0,255} = 20;
  
  foo = function( x, y, z: R{0,255} ):R{0,255}
    if x > z then
      a((z*2+y) mod 100).x := x;
    else
      t : R{0,510} = y + out4tack().x;
      if t > 255 then
        t := 255;
      end
      a(out2tack(x)-z).y := R{0,255}( t );
    end
    return (x + y * z + a(out1tack(x)).y * a(out1tack(y)).x) mod 256;
  end
  
  inTick : slot( x: R{0,255} )
    f := foo( out1tack( x ), out2tack( out3tack(  (x + 10 * 5) mod 100 ) ), (foo( 1, 2, 3) * 3 + 2) and 127 );
  end

  inTack : response( x: R{0,255} ):R{0,255}
    return f;
  end

end

