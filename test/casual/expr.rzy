
type
  Point = Record
    x : R{0,255};
    y : R{0,255};
  end

interface
  Tick
    function tick( x: R{0,255} );
    function tack( x: R{0,255} ):R{0,255};
  end
  
  Tack
    function tack():Point;
    function tock();
  end

component
  Expr
    input
      in  : Tick;
    
    output
      out1 : Tick;
      out2 : Tick;
      out3 : Tick;
      out4 : Tack;
      
    implementation elementary
    
    var
      a : Array{10,Point};
      f : R{0,255};
    
    function foo( x, y, z: R{0,255} ):R{0,255}
      if x > z then
        a[(z*2+y) mod 100].x := x;
      else
        t : R{0,510} = y + out4.tack().x;
        if t > 255 then
          t := 255;
        end
        a[out2.tack(x)-z].y := t;
      end
      return (x + y * z + a[out1.tack(x)].y * a[out1.tack(y)].x) mod 256;
    end
    
    function in.tick( x: R{0,255} )
      f := foo( out1.tack( x ), out2.tack( out3.tack(  (x + 10 * 5) mod 100 ) ), (foo( 1, 2, 3) * 3 + 2) and 127 );
    end

    function in.tack( x: R{0,255} ):R{0,255}
      return f;
    end

  end

